# STMP
Модуль памяти для "Электроника МК 90" на основе микроконтроллера STM32.

**Возможности:**
- Простое копирование образов картриджей - при подключении к ПК модуль работает как флешка;
- При подключении к МК90 модуль монитирует autorun.bin или первый попавшийся образ и работает как обычный СМП (только на чтение);
- Поддержка (только на чтение) протокола [Genjitsu SMP](https://github.com/vladkorotnev/SMPEmu/tree/master/pdp) благодаря чему можно загрузить несколько образов и выбирать нужный из списка непосредственно на МК90.

На текущий момент готова [прошивка](https://github.com/azya52/stmp/stmp) для популярной отладочной платы Blue Pill на микроконтроллере STM32F103C8T6.

**Что понадобится:**
- Сама отладочная плата Blue Pill;
- Программатор, в качестве которого можно использовать ST-Link или любой адаптер USB-UART (или Arduino);
- Пара резисторов.

**Схема подключения**

<img src="/HW/sketch.png?raw=true" width="100%">

Для начала, нужно прошить Blue Pill через ST-Link (с помощью [STM32CubeProg](https://www.st.com/en/development-tools/stm32cubeprog.html)) или через UART ([например как описано здесь](https://habr.com/ru/post/395577/)). Затем попробовать подключить модуль к ПК, который должен его определить как Mass Storage Device. Его нужно отформатировать в FAT с дефолтными параметрами, в итоге получится "флешка" на ~90КБ, на которую можно копировать образы. Если модуль был прошит нормально а ПК его не видит, то возможно придется перепаять на отладочной плате один из резисторов (известная проблема Blue Pill, описанная например [здесь](http://amitesh-singh.github.io/stm32/2017/05/27/Overcoming-wrong-pullup-in-blue-pill.html)).
Если модуль отформатировался нормально и на него скопирован какой-либо образ, можно подключать его к МК-90 по указанной выше схеме.

**Мультикартридж**

Для возможности выбора образа из нескольких непосредственно на МК90, достаточно скопировать [загрузчик](https://github.com/vladkorotnev/SMPEmu/blob/master/pdp/smp0.bin) на модуль, переименовав в autorun.bin и конечно скопировать нужные образы.

